# 模型多维度排行榜需求文档

## 1. 功能概述
在现有"模型能力榜"基础上，新增**平均响应时间**和**平均输出长度**两个排名维度，形成三维度综合排行榜。

## 2. 数据指标定义

### 2.1 平均响应时间
- **定义**：该模型在所有问答轮次中的平均响应时间
- **计算方式**：所有该模型的响应时间之和 / 该模型参与问答的次数
- **单位**：毫秒 (ms)
- **排序规则**：时间越短排名越前（倒序）
- **列名**：平均响应时间

### 2.2 平均输出长度
- **定义**：该模型在所有问答轮次中的平均输出字符数
- **计算方式**：所有该模型的输出字符数之和 / 该模型参与问答的次数
- **单位**：字符数
- **排序规则**：字符数越多排名越前（正序）
- **列名**：平均输出长度

### 2.3 模型能力（现有）
- **来源**：Artificial Analysis Intelligence Index
- **排序规则**：分数越高排名越前（正序）
- **列名**：能力指数

### 2.4 综合排名
- **定义**：三个维度排名的平均值
- **计算方式**：(速度排名 + 长度排名 + 能力排名) / 3
- **排序规则**：平均值越小排名越前
- **处理平局**：平均排名相同时，随机排序
- **列名**：综合排名

## 3. UI 设计

### 3.1 表格结构
| 模型 | 平均响应时间 | 平均输出长度 | 能力指数 | 综合排名 |
|------|-------------|-------------|---------|---------|
| Claude | 1200ms | 850 | 53 | 1 |
| GPT-5 | 1500ms | 920 | 51 | 2 |

### 3.2 交互设计
- 四个表头（平均响应时间、平均输出长度、能力指数、综合排名）均可点击
- 点击后切换该列的排序方式（正序/倒序）
- 当前排序的表头显示箭头图标（↑正序 ↓倒序）
- 默认排序：综合排名（正序，第1名在前）

### 3.3 显示规则
- 没有问答记录时：
  - 平均响应时间列显示 "-"
  - 平均输出长度列显示 "-"
  - 综合排名仅基于能力指数计算（即能力排名 = 综合排名）
- 有问答记录时：正常计算显示

## 4. 数据更新机制

### 4.1 自动更新时机
1. 每次问答完成后自动更新
2. 删除某条历史记录后自动重新计算
3. 页面加载时根据当前历史记录计算

### 4.2 数据存储
- 不单独存储排名数据
- 每次从 `state.history` 实时计算
- 确保数据一致性

## 5. 排序规则详解

### 5.1 各列独立排序
- **平均响应时间**：时间短的在前（毫秒数小的在前）
- **平均输出长度**：字符数多的在前（数值大的在前）
- **能力指数**：分数高的在前（数值大的在前）
- **综合排名**：排名数字小的在前（第1名在前）

### 5.2 平局处理
任意维度的排名出现平局时：
1. 按模型名称首字母排序（A-Z）
2. 如果还相同，则随机排序

### 5.3 综合排名计算示例

假设数据：
| 模型 | 响应时间 | 速度排名 | 输出长度 | 长度排名 | 能力 | 能力排名 |
|------|---------|---------|---------|---------|------|---------|
| Claude | 1000ms | 1 | 800 | 2 | 53 | 1 |
| GPT-5 | 1200ms | 2 | 900 | 1 | 51 | 2 |
| Gemini | 1500ms | 3 | 700 | 3 | 48 | 3 |

计算：
- Claude: (1 + 2 + 1) / 3 = 1.33 → 第1名
- GPT-5: (2 + 1 + 2) / 3 = 1.67 → 第2名
- Gemini: (3 + 3 + 3) / 3 = 3.00 → 第3名

## 6. 代码实现要求

### 6.1 文件修改
- 仅修改 `index.html`
- 保持现有代码结构和风格
- 不删除任何现有功能

### 6.2 新增函数
1. `calculateModelStats()` - 计算各模型统计数据
2. `calculateRankings()` - 计算各维度排名
3. `renderStatsTable(sortBy, sortOrder)` - 渲染表格
4. `sortModels(models, sortBy, sortOrder)` - 排序逻辑

### 6.3 集成点
- 在 `runQuery()` 完成后调用更新
- 在 `deleteHistoryRecord()` 后调用更新
- 在页面初始化时调用

## 7. 测试用例

### 7.1 基础功能测试
1. 有历史记录时，表格正确显示各模型数据
2. 点击表头能正确切换排序
3. 综合排名计算正确

### 7.2 边界情况测试
1. 无历史记录时，时间/长度显示 "-"
2. 删除所有记录后，表格正确重置
3. 多模型平局时随机排序正常

### 7.3 兼容性测试
1. 不影响现有问答功能
2. 不影响历史记录功能
3. 不影响模型能力榜原有功能

## 8. 验收标准

- [x] 三个表头可点击切换排序
- [x] 数据从现有历史记录实时计算
- [x] 问答后自动更新
- [x] 删除记录后自动重算
- [x] 综合排名计算正确
- [x] 平局处理逻辑正确
- [x] 无历史记录时显示 "-"
- [x] 不影响任何现有功能
- [x] 代码整洁、注释清晰
